---
const navLinks = [
  { href: "/", label: "Home" },
  { href: "/shop/", label: "Shop", children: [
    { href: "/shop/", label: "All Products" },
    { href: "/shop/flower/", label: "Cannabis Flower" },
    { href: "/shop/concentrates/", label: "Concentrates" },
    { href: "/shop/edibles/", label: "Edibles" },
    { href: "/shop/thc-gummies/", label: "THC Gummies" },
    { href: "/shop/vapes/", label: "Vapes" },
    { href: "/shop/pre-rolls/", label: "Pre-Rolls" },
    { href: "/shop/hash/", label: "Hash" }
  ]},
  { href: "/how-it-works/", label: "How It Works" },
  { href: "/buy-bitcoin/", label: "Payment Options", children: [
    { href: "/buy-bitcoin/", label: "Bitcoin" },
    { href: "/pay-with-bank-transfer/", label: "Bank Transfer" },
    { href: "/pay-with-paysafecard/", label: "Paysafecard" }
  ]},
  { href: "/blog/", label: "Blog" },
  { href: "/about-us/", label: "About" },
  { href: "/faq/", label: "Help" },
];
---

<header class="header" id="header">
  <div class="container">
    <div class="header-inner">
      <!-- Logo -->
      <a href="/" class="logo">
        <div class="logo-mark">
          <svg width="32" height="32" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="32" cy="32" r="30" fill="var(--color-primary)"/>
            <g transform="translate(32,34)">
              <path d="M0,-18 C1,-15 2.5,-11 1.5,-8 C3,-11 7,-16 11,-18 C9.5,-13 7,-10 5,-7 C8,-8 13,-8 16,-6.5 C12,-4 8,-2.5 5,-1.5 C7,-0.5 11,1 13,4 C10,3 6.5,1.5 4,0 C5,2.5 5,6 3,10 C1.5,6 1,3 0,1 C-1,3 -1.5,6 -3,10 C-5,6 -5,2.5 -4,0 C-6.5,1.5 -10,3 -13,4 C-11,1 -7,-0.5 -5,-1.5 C-8,-2.5 -12,-4 -16,-6.5 C-13,-8 -8,-8 -5,-7 C-7,-10 -9.5,-13 -11,-18 C-7,-16 -3,-11 -1.5,-8 C-2.5,-11 -1,-15 0,-18Z" fill="#8BA888"/>
              <line x1="0" y1="1" x2="0" y2="14" stroke="#8BA888" stroke-width="2" stroke-linecap="round"/>
            </g>
          </svg>
        </div>
        <div class="logo-text">
          <span class="logo-main">Mullaways</span>
          <span class="logo-sub">Medical Cannabis</span>
        </div>
      </a>

      <!-- Navigation -->
      <nav class="nav" id="nav">
        <ul class="nav-list">
          {navLinks.map((link) => (
            <li class={`nav-item ${link.children ? 'has-dropdown' : ''}`}>
              <a href={link.href} class="nav-link">{link.label}</a>
              {link.children && (
                <div class="dropdown">
                  <ul class="dropdown-list">
                    {link.children.map((child) => (
                      <li><a href={child.href} class="dropdown-link">{child.label}</a></li>
                    ))}
                  </ul>
                </div>
              )}
            </li>
          ))}
        </ul>
      </nav>

      <!-- Header Actions (Ecommerce) -->
      <div class="header-actions">
        <!-- Search Button -->
        <button class="action-btn search-btn" id="search-btn" aria-label="Search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.3-4.3"/>
          </svg>
        </button>

        <!-- Cart Button -->
        <button class="action-btn cart-btn" aria-label="Cart" id="cart-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          <span class="cart-count" id="cart-count">0</span>
        </button>

        <!-- Contact CTA -->
    		<a href="/contact/" class="btn btn-primary btn-sm">Contact</a>
      </div>

      <!-- Mobile Toggle -->
      <button class="mobile-toggle" id="mobile-toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </div>
</header>

<!-- Cart Slide-out Modal (outside header to avoid z-index stacking issues) -->
<div class="cart-modal-overlay" id="cart-modal-overlay"></div>
<div class="cart-modal" id="cart-modal">
  <div class="cart-modal-header">
    <div class="cart-modal-header-content">
      <div class="cart-modal-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <path d="M16 10a4 4 0 0 1-8 0"/>
        </svg>
      </div>
      <div>
        <h3>Shopping Cart</h3>
        <p class="cart-modal-count" id="cart-modal-count">0 items</p>
      </div>
    </div>
    <button class="cart-modal-close" id="cart-modal-close" aria-label="Close cart">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  </div>
  <div class="cart-modal-body" id="cart-modal-body">
    <!-- Cart items will be populated by JavaScript -->
    <div class="cart-empty" id="cart-modal-empty">
      <div class="cart-empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <path d="M16 10a4 4 0 0 1-8 0"/>
        </svg>
      </div>
      <h4>Your cart is empty</h4>
      <p>Add some products to get started</p>
      <a href="/shop/" class="btn btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Browse Products
      </a>
    </div>
    <div class="cart-items-list" id="cart-modal-items" style="display: none;"></div>
  </div>
  <div class="cart-modal-footer" id="cart-modal-footer" style="display: none;">
    <div class="cart-modal-summary">
      <div class="cart-modal-summary-row">
        <span>Subtotal</span>
        <span class="cart-total-amount" id="cart-modal-total">$0.00</span>
      </div>
      <div class="cart-modal-summary-row cart-modal-summary-shipping">
        <span>Shipping</span>
        <span class="cart-shipping-note">Calculated at checkout</span>
      </div>
    </div>
    <div class="cart-modal-actions">
      <a href="/cart/" class="btn btn-cart-view">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        View Cart
      </a>
      <a href="/checkout/" class="btn btn-cart-checkout" id="cart-checkout-btn">
        Checkout
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
    <div class="cart-modal-secure">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
      <span>Secure checkout with SSL encryption</span>
    </div>
  </div>
</div>

<!-- Search Overlay -->
<div class="search-overlay" id="search-overlay">
  <div class="search-container">
    <form class="search-form" action="/shop/" method="get">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.3-4.3"/>
      </svg>
      <input type="search" name="q" placeholder="Search products..." class="search-input" id="search-input" autocomplete="off"/>
      <button type="button" class="search-close" id="search-close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </form>
    <div class="search-suggestions">
      <p class="search-label">Popular Searches</p>
      <div class="search-tags">
        <a href="/shop/flower/">Flower</a>
        <a href="/shop/concentrates/">Concentrates</a>
        <a href="/shop/edibles/">Edibles</a>
        <a href="/shop/thc-gummies/">THC Gummies</a>
        <a href="/shop/vapes/">Vapes</a>
      </div>
    </div>
  </div>
</div>

<style>
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: var(--color-white);
    padding: 0;
    transition: all var(--transition-base);
    border-bottom: 1px solid transparent;
  }

  .header.scrolled {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom-color: var(--color-border);
    box-shadow: var(--shadow-sm);
  }

  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: var(--header-height);
    gap: var(--space-xl);
  }

  /* Logo */
  .logo {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    color: var(--color-primary);
    transition: opacity var(--transition-fast);
  }

  .logo:hover {
    opacity: 0.8;
    color: var(--color-primary);
  }

  .logo-mark {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-primary);
  }

  .logo-text {
    display: flex;
    flex-direction: column;
    line-height: 1.1;
  }

  .logo-main {
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--color-text);
    letter-spacing: -0.02em;
  }

  .logo-sub {
    font-family: var(--font-primary);
    font-size: 0.7rem;
    font-weight: 500;
    color: var(--color-text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  /* Navigation */
  .nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .nav-list {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  .nav-item {
    position: relative;
  }

  .nav-item.has-dropdown:hover .dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .nav-link {
    display: block;
    padding: 8px 16px;
    color: var(--color-text-light);
    font-size: 0.9rem;
    font-weight: 500;
    border-radius: var(--radius-full);
    transition: all var(--transition-fast);
    position: relative;
  }

  .nav-link:hover {
    color: var(--color-primary);
    background: rgba(45, 90, 74, 0.06);
  }

  /* Dropdown Menu */
  .dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    background: var(--color-white);
    border-radius: var(--radius-lg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    min-width: 180px;
    padding: var(--space-sm) 0;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 1000;
  }

  .dropdown::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid var(--color-white);
  }

  .dropdown-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .dropdown-link {
    display: block;
    padding: 10px 20px;
    color: var(--color-text-light);
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.15s ease;
  }

  .dropdown-link:hover {
    color: var(--color-primary);
    background: rgba(45, 90, 74, 0.06);
  }

  /* Header Actions */
  .header-actions {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    background: transparent;
    border: none;
    color: var(--color-text-light);
    cursor: pointer;
    transition: all var(--transition-fast);
    position: relative;
  }

  .action-btn:hover {
    background: var(--color-bg-alt);
    color: var(--color-primary);
  }

  .cart-btn {
    position: relative;
  }

  .cart-count {
    position: absolute;
    top: 4px;
    right: 4px;
    background: var(--color-terracotta);
    color: white;
    font-size: 0.65rem;
    font-weight: 600;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
  }

  .cart-count.bump {
    animation: cartBump 0.3s ease;
  }

  @keyframes cartBump {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }

  .btn-sm {
    padding: 10px 20px;
    font-size: 0.85rem;
  }

  /* Search Overlay */
  .search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    padding: 100px 0 40px;
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 999;
  }

  .search-overlay.active {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
  }

  .search-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
  }

  .search-form {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    background: var(--color-bg-alt);
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--radius-full);
    border: 2px solid transparent;
    transition: border-color 0.3s ease;
  }

  .search-form:focus-within {
    border-color: var(--color-primary);
    background: white;
  }

  .search-form svg {
    color: var(--color-text-muted);
    flex-shrink: 0;
  }

  .search-input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 1.125rem;
    color: var(--color-text);
    outline: none;
  }

  .search-input::placeholder {
    color: var(--color-text-muted);
  }

  .search-close {
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 4px;
    transition: color 0.2s ease;
  }

  .search-close:hover {
    color: var(--color-text);
  }

  .search-suggestions {
    margin-top: var(--space-xl);
    text-align: center;
  }

  .search-label {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: var(--space-md);
  }

  .search-tags {
    display: flex;
    gap: var(--space-sm);
    justify-content: center;
    flex-wrap: wrap;
  }

  .search-tags a {
    display: inline-block;
    padding: 8px 16px;
    background: var(--color-bg-alt);
    color: var(--color-text-light);
    border-radius: var(--radius-full);
    font-size: 0.875rem;
    transition: all 0.2s ease;
  }

  .search-tags a:hover {
    background: var(--color-primary);
    color: white;
  }

  /* Mobile Toggle */
  .mobile-toggle {
    display: none;
    flex-direction: column;
    gap: 5px;
    padding: 8px;
    background: none;
    border: none;
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: background var(--transition-fast);
  }

  .mobile-toggle:hover {
    background: var(--color-bg-alt);
  }

  .mobile-toggle span {
    display: block;
    width: 20px;
    height: 2px;
    background: var(--color-text);
    transition: all var(--transition-base);
    border-radius: 1px;
  }

  .mobile-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .mobile-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .mobile-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(5px, -5px);
  }

  @media (max-width: 1024px) {
    .header-actions .btn {
      display: none;
    }
  }

  @media (max-width: 900px) {
    .mobile-toggle {
      display: flex;
    }

    .header-actions .search-btn {
      display: none;
    }

    .nav {
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--color-white);
      padding: var(--space-xl);
      transform: translateX(100%);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      flex-direction: column;
      justify-content: flex-start;
      overflow-y: auto;
      z-index: 999;
      -webkit-overflow-scrolling: touch;
    }

    .nav.active {
      transform: translateX(0);
      opacity: 1;
      visibility: visible;
    }

    .nav-list {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-xs);
      width: 100%;
    }

    .nav-item {
      position: relative;
    }

    .nav-link {
      font-size: 1.1rem;
      padding: var(--space-md);
      text-align: left;
      border-radius: var(--radius-md);
    }

    .nav-link:hover {
      background: var(--color-bg);
    }

    /* Mobile dropdown - always visible */
    .dropdown {
      position: static;
      opacity: 1;
      visibility: visible;
      transform: none;
      box-shadow: none;
      background: var(--color-bg-alt);
      border-radius: var(--radius-md);
      margin-top: var(--space-xs);
      padding: var(--space-sm);
    }

    .dropdown::before {
      display: none;
    }

    .dropdown-link {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
    }
  }

  /* Cart Modal - Professional Redesign */
  .cart-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1002;
  }

  .cart-modal-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .cart-modal {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 420px;
    max-width: 100%;
    background: #ffffff;
    box-shadow: -8px 0 30px rgba(0, 0, 0, 0.15);
    transform: translateX(100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1003;
    display: flex;
    flex-direction: column;
  }

  .cart-modal.active {
    transform: translateX(0);
  }

  .cart-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    background: linear-gradient(135deg, #1a472a 0%, #2d5a3f 100%);
    color: white;
  }

  .cart-modal-header-content {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .cart-modal-icon {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-modal-header h3 {
    font-size: 1.15rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: -0.01em;
  }

  .cart-modal-count {
    font-size: 0.85rem;
    opacity: 0.8;
    margin: 2px 0 0;
  }

  .cart-modal-close {
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .cart-modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }

  .cart-modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 0;
    background: #fafafa;
  }

  /* Empty Cart State */
  .cart-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    padding: 48px 32px;
    gap: 16px;
  }

  .cart-empty-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #f0f7f2 0%, #e8f5ec 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1a472a;
    margin-bottom: 8px;
  }

  .cart-empty h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0;
  }

  .cart-empty p {
    color: #666;
    margin: 0;
    font-size: 0.95rem;
  }

  .cart-empty .btn {
    margin-top: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    font-weight: 500;
  }

  /* Cart Items List - Using :global for JS-generated content */
  .cart-items-list {
    display: flex;
    flex-direction: column;
    padding: 16px;
    gap: 12px;
  }

  :global(.cart-modal-item) {
    display: flex !important;
    flex-direction: row !important;
    gap: 16px;
    padding: 16px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
    position: relative;
    align-items: flex-start;
  }

  :global(.cart-modal-item:hover) {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-color: rgba(26, 71, 42, 0.1);
  }

  :global(.cart-modal-item-image) {
    width: 64px;
    height: 64px;
    min-width: 64px;
    background: linear-gradient(135deg, #f0f7f2 0%, #e8f5ec 100%);
    border-radius: 10px;
    display: flex !important;
    align-items: center;
    justify-content: center;
    color: #1a472a;
    flex-shrink: 0;
  }

  :global(.cart-modal-item-image svg) {
    width: 28px;
    height: 28px;
  }

  :global(.cart-modal-item-details) {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 6px;
    padding-right: 30px;
  }

  :global(.cart-modal-item-name) {
    font-weight: 600;
    font-size: 0.95rem;
    color: #1a1a1a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
    margin: 0;
  }

  :global(.cart-modal-item-meta) {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  :global(.cart-modal-item-price) {
    color: #1a472a;
    font-weight: 700;
    font-size: 1rem;
  }

  :global(.cart-modal-item-qty) {
    font-size: 0.8rem;
    color: #666;
    background: #f5f5f5;
    padding: 3px 10px;
    border-radius: 20px;
  }

  :global(.cart-modal-item-remove) {
    position: absolute;
    top: 50%;
    right: 12px;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
    background: #f5f5f5;
    border: none;
    border-radius: 8px;
    color: #999;
    cursor: pointer;
    display: flex !important;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    padding: 0;
  }

  :global(.cart-modal-item-remove:hover) {
    background: #fee2e2;
    color: #dc2626;
  }

  :global(.cart-modal-item-remove svg) {
    width: 18px;
    height: 18px;
  }

  /* Cart Footer */
  .cart-modal-footer {
    padding: 20px 24px 24px;
    background: #ffffff;
    border-top: 1px solid #eee;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
  }

  .cart-modal-summary {
    margin-bottom: 20px;
  }

  .cart-modal-summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
  }

  .cart-modal-summary-row:first-child {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1a1a1a;
    padding-bottom: 12px;
    border-bottom: 1px dashed #e5e5e5;
  }

  .cart-modal-summary-row .cart-total-amount {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1a472a;
  }

  .cart-modal-summary-shipping {
    font-size: 0.9rem;
    color: #666;
    padding-top: 12px;
  }

  .cart-shipping-note {
    font-style: italic;
    color: #888;
  }

  .cart-modal-actions {
    display: flex;
    gap: 12px;
  }

  .btn-cart-view {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 20px;
    background: transparent;
    color: #1a1a1a;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1.5px solid rgba(139, 168, 136, 0.5);
  }

  .btn-cart-view:hover {
    background: var(--color-sage);
    border-color: var(--color-sage);
    color: #1a1a1a;
    transform: translateX(2px);
  }

  .btn-cart-checkout {
    flex: 1.2;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 24px;
    background: var(--color-sage);
    color: #1a1a1a;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: none;
  }

  .btn-cart-checkout:hover {
    background: #9dbc9a;
    transform: translateX(2px);
    box-shadow: 0 4px 14px rgba(139, 168, 136, 0.35);
    color: #1a1a1a;
  }

  .cart-modal-secure {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-top: 16px;
    font-size: 0.8rem;
    color: #888;
  }

  .cart-modal-secure svg {
    color: #1a472a;
  }

  @media (max-width: 480px) {
    .cart-modal {
      width: 100%;
    }

    .cart-modal-header {
      padding: 16px 20px;
    }

    .cart-modal-footer {
      padding: 16px 20px 20px;
    }

    .cart-items-list {
      padding: 12px;
    }

    :global(.cart-modal-item) {
      padding: 14px;
      flex-wrap: nowrap;
    }

    :global(.cart-modal-item-image) {
      width: 56px;
      height: 56px;
      min-width: 56px;
    }

    :global(.cart-modal-item-details) {
      padding-right: 24px;
    }

    :global(.cart-modal-item-name) {
      font-size: 0.9rem;
    }

    :global(.cart-modal-item-price) {
      font-size: 0.9rem;
    }

    .cart-modal-actions {
      flex-direction: column;
    }

    .btn-cart-view,
    .btn-cart-checkout {
      flex: none;
      width: 100%;
    }
  }

  /* Account Dropdown mobile - removed */
</style>

<script>
  // Mobile menu toggle
  const toggle = document.getElementById('mobile-toggle');
  const nav = document.getElementById('nav');
  const header = document.getElementById('header');

  function openMobileMenu() {
    nav?.classList.add('active');
    toggle?.classList.add('active');
    document.body.classList.add('no-scroll');
    // Fix iOS: set body position fixed to truly prevent scroll
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
    document.body.style.top = `-${window.scrollY}px`;
  }

  function closeMobileMenu() {
    nav?.classList.remove('active');
    toggle?.classList.remove('active');
    // Restore scroll position before removing fixed positioning
    const scrollY = document.body.style.top;
    document.body.style.position = '';
    document.body.style.width = '';
    document.body.style.top = '';
    document.body.classList.remove('no-scroll');
    window.scrollTo(0, parseInt(scrollY || '0') * -1);
  }

  toggle?.addEventListener('click', () => {
    if (nav?.classList.contains('active')) {
      closeMobileMenu();
    } else {
      openMobileMenu();
    }
  });

  // Close mobile menu when a nav link is clicked
  nav?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      closeMobileMenu();
    });
  });

  // Close mobile menu on scroll (handles any scroll that leaks through)
  window.addEventListener('scroll', () => {
    if (nav?.classList.contains('active')) {
      closeMobileMenu();
    }
  });

  // Prevent background page from scrolling via touch while menu is open
  document.addEventListener('touchmove', (e) => {
    if (!nav?.classList.contains('active')) return;
    // Allow scrolling inside the nav itself
    if (nav && nav.contains(e.target as Node)) return;
    e.preventDefault();
  }, { passive: false });

  // Scroll effect
  window.addEventListener('scroll', () => {
    if (window.scrollY > 20) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  });

  // Search functionality
  const searchBtn = document.getElementById('search-btn');
  const searchOverlay = document.getElementById('search-overlay');
  const searchClose = document.getElementById('search-close');
  const searchInput = document.getElementById('search-input');

  searchBtn?.addEventListener('click', () => {
    searchOverlay?.classList.add('active');
    setTimeout(() => searchInput?.focus(), 100);
  });

  searchClose?.addEventListener('click', () => {
    searchOverlay?.classList.remove('active');
  });

  // Close search on escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      searchOverlay?.classList.remove('active');
      cartModal?.classList.remove('active');
      cartOverlay?.classList.remove('active');
      closeMobileMenu();
      document.body.classList.remove('no-scroll');
    }
  });

  // Cart Modal
  const cartBtn = document.getElementById('cart-btn');
  const cartModal = document.getElementById('cart-modal');
  const cartOverlay = document.getElementById('cart-modal-overlay');
  const cartModalClose = document.getElementById('cart-modal-close');
  const cartModalBody = document.getElementById('cart-modal-body');
  const cartModalItems = document.getElementById('cart-modal-items');
  const cartModalEmpty = document.getElementById('cart-modal-empty');
  const cartModalFooter = document.getElementById('cart-modal-footer');
  const cartModalTotal = document.getElementById('cart-modal-total');
  const cartModalCount = document.getElementById('cart-modal-count');

  cartBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    openCartModal();
  });

  cartModalClose?.addEventListener('click', () => {
    closeCartModal();
  });

  cartOverlay?.addEventListener('click', () => {
    closeCartModal();
  });

  window.addEventListener('openCartModal', () => {
    openCartModal();
  });

  function openCartModal() {
    cartModal?.classList.add('active');
    cartOverlay?.classList.add('active');
    document.body.classList.add('no-scroll');
    updateCartModal();
  }

  function closeCartModal() {
    cartModal?.classList.remove('active');
    cartOverlay?.classList.remove('active');
    document.body.classList.remove('no-scroll');
  }

  function updateCartModal() {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    
    // Clean up invalid cart items (no name or undefined)
    const cleanedCart = cart.filter((item: any) => item.name && item.name !== 'undefined');
    if (cleanedCart.length !== cart.length) {
      localStorage.setItem('cart', JSON.stringify(cleanedCart));
      cart = cleanedCart;
      window.dispatchEvent(new CustomEvent('cartUpdated'));
    }
    
    // Calculate total items
    const totalItems = cart.reduce((acc: number, item: any) => acc + (item.quantity || 1), 0);
    
    // Update item count in header
    if (cartModalCount) {
      cartModalCount.textContent = totalItems === 1 ? '1 item' : `${totalItems} items`;
    }
    
    if (cart.length === 0) {
      if (cartModalEmpty) cartModalEmpty.style.display = 'flex';
      if (cartModalItems) cartModalItems.style.display = 'none';
      if (cartModalFooter) cartModalFooter.style.display = 'none';
    } else {
      if (cartModalEmpty) cartModalEmpty.style.display = 'none';
      if (cartModalItems) {
        cartModalItems.style.display = 'flex';
        const leafIcon = '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z"/><path d="M12 6c0 0-4 4-4 8s4 6 4 6 4-2 4-6-4-8-4-8z"/></svg>';
        cartModalItems.innerHTML = cart.map((item: any, index: number) => `
          <div class="cart-modal-item">
            <div class="cart-modal-item-image">${item.icon || leafIcon}</div>
            <div class="cart-modal-item-details">
              <div class="cart-modal-item-name">${item.name || 'Unknown Product'}</div>
              <div class="cart-modal-item-meta">
                <span class="cart-modal-item-price">$${(parseFloat(item.price) || 0).toFixed(2)}</span>
                <span class="cart-modal-item-qty">Qty: ${item.quantity || 1}</span>
              </div>
            </div>
            <button class="cart-modal-item-remove" data-index="${index}" aria-label="Remove item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        `).join('');

        // Add remove handlers
        cartModalItems.querySelectorAll('.cart-modal-item-remove').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const index = parseInt((e.currentTarget as HTMLElement).getAttribute('data-index') || '0');
            removeFromCart(index);
          });
        });
      }
      if (cartModalFooter) cartModalFooter.style.display = 'block';
      
      const total = cart.reduce((acc: number, item: any) => {
        return acc + ((parseFloat(item.price) || 0) * (item.quantity || 1));
      }, 0);
      if (cartModalTotal) cartModalTotal.textContent = `$${total.toFixed(2)}`;
    }
  }

  function removeFromCart(index: number) {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    cart.splice(index, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
    window.dispatchEvent(new CustomEvent('cartUpdated'));
    updateCartModal();
  }

  // Cart count from localStorage
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const count = cart.reduce((acc: number, item: any) => acc + (item.quantity || 1), 0);
    const cartCountEl = document.getElementById('cart-count');
    if (cartCountEl) {
      cartCountEl.textContent = count.toString();
      if (count > 0) {
        cartCountEl.style.display = 'flex';
      } else {
        cartCountEl.style.display = 'none';
      }
    }
  }

  // Initial cart count
  updateCartCount();

  // Listen for cart updates
  window.addEventListener('storage', updateCartCount);
  window.addEventListener('cartUpdated', () => {
    updateCartCount();
    updateCartModal();
  });
</script>
